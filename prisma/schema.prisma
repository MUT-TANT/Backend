// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Goal {
  id                  Int          @id @default(autoincrement())
  blockchainGoalId    Int?         @unique // On-chain goal ID from smart contract
  name                String
  owner               String       // Ethereum address
  currency            String       // Token address
  mode                Int          @default(0) // 0 = Lite, 1 = Pro
  targetAmount        String       // Stored as string to handle large numbers
  duration            Int          // Duration in days
  donationPercentage  Int          @default(500) // 5% = 500 basis points
  depositedAmount     String       @default("0")
  currentValue        String       @default("0")
  yieldEarned         String       @default("0")
  status              Int          @default(0) // 0 = Active, 1 = Completed, 2 = Abandoned, 3 = Withdrawn
  currentStreak       Int          @default(0) // Current consecutive days streak
  longestStreak       Int          @default(0) // Longest streak achieved
  lastStreakUpdate    DateTime     @default(now()) // Last time streak was updated
  createdAt           DateTime     @default(now())
  lastDepositTime     DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  dailySaves          DailySave[]  // Relation to daily save records

  @@index([owner])
  @@index([status])
  @@index([blockchainGoalId])
}

model DailySave {
  id        Int      @id @default(autoincrement())
  goalId    Int
  goal      Goal     @relation(fields: [goalId], references: [id], onDelete: Cascade)
  date      DateTime @db.Date // Only date, no time
  amount    String   // Amount saved on this day
  createdAt DateTime @default(now())

  @@unique([goalId, date]) // One save per day per goal
  @@index([goalId])
  @@index([date])
}
